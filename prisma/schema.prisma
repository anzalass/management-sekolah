// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Sekolah {
  id    String @id @default(uuid())
  nama  String
  npsn String
  kas   Int?
  desa String
  kecamatan String
  kabupaten String
  provinsi String
  telephone String
  email String
  website String
  namaKepsek String
  logo String?
  logoId String?
  tahunAjaran String
}

model Guru {
  id            String @id @default(uuid())
  nip            String @unique
  nik            String
  password       String
  jabatan        String
  nama           String
  tempatLahir    String
  tanggalLahir   DateTime?
  alamat         String 
  agama          String
  jenisKelamin   String
  noTelepon      String
  email          String @unique
  status         StatusGuru
  foto           String?
  fotoId         String?  
  RiwayatPendidikanGuru RiwayatPendidikanGuru[]
  Kelas          Kelas[]
  KehadiranGuru  KehadiranGuru[]
  KelasDanMapel  KelasDanMapel[]
  Logs           Logs[]
  testimoni     Testimoni[]
  news          News[]
  gallery       Gallery[]
  guruTemplate  GuruTemplate[]
  jadwalMengajar jadwalMengajar[]
  PerizinanGuru PerizinanGuru[]
  JanjiTemu JanjiTemu[]

}

enum StatusGuru {
  Aktif
  NonAktif
}

model jadwalMengajar {
    id            String @id @default(uuid())
    kelas String
    idGuru String
    jamMulai String
    jamSelesai String
    namaMapel String
    hari String
    ruang String
    Guru              Guru               @relation(fields: [idGuru], references: [id])


}

model KehadiranGuru {
  id            String   @id @default(uuid())
  idGuru        String
  tanggal       DateTime @default(now())
  jamMasuk      DateTime?
  jamPulang     DateTime?
  fotoMasuk     String?
  lokasiMasuk   String?   // simpan JSON string: {"lat": -6.2, "long": 106.8}
  lokasiPulang  String?
  status        String?
  Guru          Guru     @relation(fields: [idGuru], references: [id])
}

model Kelas {
  id                String             @id @default(uuid())
  idGuru            String?           
  nama              String
  namaGuru          String
  nipGuru           String
  banner            String?
  bannerId      String?
  ruangKelas        String
  tahunAjaran       String
  KehadiranSiswa    KehadiranSiswa[]
  Guru              Guru?          @relation(fields: [idGuru], references: [id])
  DaftarSiswaKelas  DaftarSiswaKelas[] 
  PerizinanSiswa    PerizinanSiswa[]
  PengumumanKelas   PengumumanKelas[]
  CatatanPerkembanganSiswa CatatanPerkembanganSiswa[]
  JadwalPelajaran     JadwalPelajaran[]
  WeeklyActivity WeeklyActivity[]
}


model JadwalPelajaran {
  id                String             @id @default(uuid())
  idKelas           String
  hari              String
  namaMapel         String
  jamMulai String
  jamSelesai String
  Kelas               Kelas  @relation(fields: [idKelas], references: [id])

}


model RiwayatPendidikanGuru {
  id                String @id @default(uuid())
  idGuru            String
  nama              String
  gelar             String
  jenjangPendidikan String
  tahunLulus        String
  Guru              Guru  @relation(fields: [idGuru], references: [id])
}


model KelasDanMapel {
  id             String          @id @default(uuid())
  idGuru         String?
  namaMapel      String
  namaGuru       String
  nipGuru        String
  ruangKelas     String
  kelas          String
  banner         String?
  bannerId       String?
  tahunAjaran    String
  Guru           Guru?            @relation(fields: [idGuru], references: [id])
  DaftarSiswa    DaftarSiswaMapel[]
  SummaryTugas   SummaryTugas[]
  SummaryMateri SummaryMateri[]
  NilaiSiswa     NilaiSiswa[]
  MateriMapel    MateriMapel[]
  TugasMapel     TugasMapel[]
  JenisNilai     JenisNilai[]
  CatatanAkhirSiswa CatatanAkhirSiswa[]
  UjianIframe UjianIframe[]
  SelesaiUjian SelesaiUjian[]


}

model DaftarSiswaMapel {
  id            String @id @default(uuid())
  idKelas       String
  idSiswa       String
  namaSiswa     String
  nisSiswa      String
  banner        String?
  bannerId      String?
  KelasDanMapel KelasDanMapel @relation(fields: [idKelas], references: [id])
  Siswa         Siswa @relation(fields: [idSiswa], references: [id])
  @@unique([idSiswa, idKelas])
}

model DaftarSiswaKelas {
  id              String @id @default(uuid())
  idKelas         String
  rapotSiswa      String?
  idSiswa         String
  namaSiswa       String
  nisSiswa        String
  Kelas       Kelas @relation(fields: [idKelas], references: [id])
  Siswa       Siswa @relation(fields: [idSiswa], references: [id])
  @@unique([idSiswa, idKelas])
}

model JenisNilai {
    id             String          @id @default(uuid())
    idKelasMapel   String
    jenis          String
    bobot          Int
    NilaiSiswa     NilaiSiswa[]
    KelasDanMapel  KelasDanMapel @relation(fields: [idKelasMapel], references: [id])
}

model NilaiSiswa {
  id              String @id @default(uuid())
  idSiswa         String
  idKelasDanMapel String
  idJenisNilai    String
  jenisNilai      String
  nilai           Int
  createdAt       DateTime?


  Siswa           Siswa @relation(fields: [idSiswa], references: [id])
  KelasDanMapel   KelasDanMapel @relation(fields: [idKelasDanMapel], references: [id])
  JenisNilai      JenisNilai @relation(fields: [idJenisNilai], references: [id])

  @@unique([idSiswa, idJenisNilai])
}

model KehadiranSiswa {
  id             String @id @default(uuid())
  idSiswa        String?
  idKelas        String?
  namaSiswa      String
  nisSiswa       String
  waktu          DateTime
  keterangan     String
  Siswa          Siswa? @relation(fields: [idSiswa], references: [id])
  Kelas          Kelas? @relation(fields: [idKelas], references: [id])
}

model Siswa {
  id            String @id @default(uuid())
  nis           String @unique 
  nik           String
  nama          String
  jurusan       String?
  password      String?
  tanggalLahir  DateTime
  tempatLahir   String
  namaAyah      String
  namaIbu       String
  tahunLulus    String?
  poin          Int?
  alamat        String?
  agama         String
  kelas         String?
  jenisKelamin  String
  foto          String?
  fotoId        String?  
  noTelepon     String
  noTeleponOrtu String  
  email         String? @unique
  ekstraKulikulerPeminatan      String?
  ekstraKulikulerWajib          String?
  DaftarSiswaMapel              DaftarSiswaMapel[]
  DaftarSiswaKelas              DaftarSiswaKelas[]
  NilaiSiswa                    NilaiSiswa[]
  KehadiranSiswa                KehadiranSiswa[]
  PelanggaranSiswa              Pelanggaran_Dan_Prestasi_Siswa[]
  Peminjaman_dan_Pengembalian   Peminjaman_dan_Pengembalian[]
  Tagihan                       Tagihan[]
  RiwayatPembayaran             RiwayatPembayaran[]
  PerizinanSiswa                PerizinanSiswa[]
  SummaryMapel                  SummaryMateri[]
  SummaryTugas                  SummaryTugas[]
  Konseling                     Konseling[]
  CatatanPerkembanganSiswa      CatatanPerkembanganSiswa[]
  CatatanAkhirSiswa      CatatanAkhirSiswa[]
  JanjiTemu   JanjiTemu[]
  SelesaiUjian SelesaiUjian[]

}

model Konseling  {
  id             String @id @default(uuid())
  idSiswa        String
  nisSiswa String
  namaSiswa String
  tanggal DateTime
  keterangan String
  Siswa          Siswa @relation(fields: [idSiswa], references: [id])

}

model Pelanggaran_Dan_Prestasi_Siswa {
  id             String @id @default(uuid())
  nisSiswa String
  idSiswa        String
  waktu          DateTime
  poin           Int
  jenis          String
  keterangan     String
  Siswa          Siswa @relation(fields: [idSiswa], references: [id])
}

model Ruangan {
  id    String @id @default(uuid())
  nama  String @unique
  keterangan String?
}

model Jenis_Inventaris {
  id           String @id @default(uuid())
  nama         String @unique
}

model Inventaris {
  id           String @id @default(uuid())
  nama         String
  quantity     Int
  ruang        String
  hargaBeli    Int
  waktuPengadaan DateTime
  keterangan   String
  Pemeliharaan_Inventaris Pemeliharaan_Inventaris[]
}

model Pemeliharaan_Inventaris {
  id              String     @id @default(uuid())
  idinventaris    String?
  nama            String
  status          String
  quantity        Int
  ruang String
  biaya           Int
  tanggal         DateTime
  keterangan      String
  Inventaris      Inventaris? @relation(fields: [idinventaris], references: [id])
}


model RiwayatAnggaran {
  id         String @id @default(uuid())
  nama       String
  tanggal    DateTime
  jumlah     Int
  jenis      String
  keterangan String
}

model KegiatanSekolah {
  id         String @id @default(uuid())
  nama       String
  tahunAjaran String
  keterangan String
  waktuMulai       DateTime
  waktuSelesai     DateTime
  status     String
}

enum StatusIzin {
  menunggu
  disetujui
  ditolak
}
model PerizinanGuru {
  id         String   @id @default(uuid())
  idGuru     String?
  keterangan String
  time       DateTime
  bukti      String
  bukti_id   String
  status     StatusIzin
  Guru       Guru? @relation(fields: [idGuru], references: [id])

}

model PerizinanSiswa {
  id         String @id @default(uuid())
  idSiswa    String
  idKelas    String?
  keterangan String
  time       DateTime
  bukti      String
  bukti_id   String
  status     StatusIzin
  Kelas      Kelas?  @relation(fields: [idKelas], references: [id])
  Siswa      Siswa  @relation(fields: [idSiswa], references: [id])
}

model Logs {
  id         String @id @default(uuid())
  idGuru     String
  keterangan String
  time       DateTime
  Guru       Guru  @relation(fields: [idGuru], references: [id])
}

model EkstraKulikuler {
  id         String @id @default(uuid())
  nama       String
  waktu      DateTime
  jenis      String
}


model Pengumuman {
  id          String @id @default(uuid())
  title       String
  time        DateTime
  content     String
}

model PengumumanKelas {
  id          String @id @default(uuid())
  idKelas     String
  title       String
  time        DateTime
  content     String
  Kelas       Kelas  @relation(fields: [idKelas], references: [id])
}


model CatatanPerkembanganSiswa  {
  id          String @id @default(uuid())
  idKelas     String?
  idSiswa     String
  content     String
  time        DateTime
  Kelas       Kelas?  @relation(fields: [idKelas], references: [id])
  Siswa       Siswa  @relation(fields: [idSiswa], references: [id])

}

model CatatanAkhirSiswa {
  id          String @id @default(uuid())
  idKelasMapel     String?
  idSiswa     String
  content     String
  KelasdanMapel       KelasDanMapel?  @relation(fields: [idKelasMapel], references: [id])
  Siswa       Siswa  @relation(fields: [idSiswa], references: [id])

  @@unique([idSiswa, idKelasMapel])

}

model Buku_Perpustakaan {
  id         String @id @default(uuid())
  nama       String
  cover      String?
  cover_id   String?
  filepdf    String?
  filePdfid  String?
  pengarang  String
  penerbit   String
  tahunTerbit Int
  keterangan  String
  stok        Int
  Peminjaman_dan_Pengembalian Peminjaman_dan_Pengembalian[]
}


model Peminjaman_dan_Pengembalian {
  id              String @id @default(uuid())
  idSiswa         String
  nisSiswa  String
  idBuku          String?
  namaBuku        String
  waktuPinjam     DateTime
  waktuKembali    DateTime
  status          StatusPeminjamanBuku
  keterangan      String?
  Buku_Perpustakaan Buku_Perpustakaan? @relation(fields: [idBuku], references: [id])
  Siswa             Siswa @relation(fields: [idSiswa], references: [id])
}

enum StatusPeminjamanBuku {
  dipinjam
  dikembalikan

}

model ListKelas {
  id      String @id @default(uuid())
  namaKelas    String @unique
}

model Mata_Pelajaran {
  id      String @id @default(uuid())
  nama    String
  kelas   String
}


model Periode_Tahun_Ajaran {
  id          String @id @default(uuid())
  tahunAjaran String
}


model Tagihan {
  id          String @id @default(uuid())
  nama        String
  namaSiswa   String
  nisSiswa    String
  idSiswa     String?
  waktu       DateTime
  jatuhTempo  DateTime
  status      String
  keterangan  String
  nominal     Int
  RiwayatPembayaran RiwayatPembayaran[]
  Siswa Siswa? @relation(fields: [idSiswa], references: [id])
}

model RiwayatPembayaran {
  id          String @id @default(uuid())
  namaSiswa   String
  nisSiswa    String
  idSiswa     String?
  idTagihan   String 
  waktuBayar  DateTime
  status  String
  metodeBayar String
  Siswa Siswa? @relation(fields: [idSiswa], references: [id])
  Tagihan Tagihan? @relation(fields: [idTagihan], references: [id])

}


model Testimoni {
  id          String   @id @default(uuid())
  image       String
  imageId     String
  parentName  String
  description String
  guruId      String?
  guru        Guru?    @relation(fields: [guruId], references: [id])
}

model News {
  id          String   @id @default(uuid())
  title       String
  content     String
  image       String
  imageId     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  guruId      String?
  guru        Guru?    @relation(fields: [guruId], references: [id])
}

model Gallery {
  id          String   @id @default(uuid())
  image       String
  imageId     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  guruId      String?
  guru        Guru?    @relation(fields: [guruId], references: [id])
}

model GuruTemplate {
  id        String   @id @default(uuid())
  name      String
  image     String
  imageId   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  guruId    String?
  guru      Guru?    @relation(fields: [guruId], references: [id])
}




model PendaftaranSiswa{
    id          String @id @default(uuid())
    kategori String
    studentName     String
    parentName  String
    yourLocation String
    phoneNumber  String
    email        String
}



model MateriMapel {
      id          String @id @default(uuid())
      idKelasMapel String
      judul        String 
      konten       String
      tanggal      DateTime
      iframeGoogleSlide String?
      iframeYoutube     String?
      pdfUrl String?
      pdfUrlId String?
      SummaryMateri SummaryMateri[]
      KelasMapel KelasDanMapel   @relation(fields: [idKelasMapel], references: [id])
}


model UjianIframe {
    id          String @id @default(uuid())
    idKelasMapel String
    nama String
    deadline DateTime
    iframe String
    KelasMapel KelasDanMapel   @relation(fields: [idKelasMapel], references: [id])
    SelesaiUjian SelesaiUjian[]
}


model SelesaiUjian {
    id    String @id @default(uuid())
    idUjianIframe String
    idSiswa String
    idKelasMapel String
    status String
    createdAt DateTime
    UjianIframe UjianIframe   @relation(fields: [idUjianIframe], references: [id])
    Siswa Siswa   @relation(fields: [idSiswa], references: [id])
    KelasMapel KelasDanMapel   @relation(fields: [idKelasMapel], references: [id])
    
    @@unique([idSiswa, idKelasMapel, idUjianIframe])
}


model SummaryMateri  {
  id   String @id @default(uuid())
  idSiswa String
  idKelasMapel String
  idMateri String
  content String
  waktu DateTime
  MateriMapel MateriMapel   @relation(fields: [idMateri], references: [id])
  Siswa Siswa   @relation(fields: [idSiswa], references: [id])
  KelasMapel KelasDanMapel   @relation(fields: [idKelasMapel], references: [id])


}

model TugasMapel {
    id          String @id @default(uuid())
    idKelasMapel String
    judul       String 
    konten String
    deadline DateTime
    iframeGoogleSlide String?
    iframeYoutube     String?
    pdfUrl String?
    pdfUrlId String?
    SummaryTugas SummaryTugas[]
    KelasMapel KelasDanMapel   @relation(fields: [idKelasMapel], references: [id])
}

model SummaryTugas {
  id   String @id @default(uuid())
  idKelasMapel String
  idSiswa String
  idTugas String
  content String
  waktu DateTime
  TugasMapel TugasMapel   @relation(fields: [idTugas], references: [id])
  Siswa Siswa   @relation(fields: [idSiswa], references: [id])
  KelasMapel KelasDanMapel   @relation(fields: [idKelasMapel], references: [id])

}


model Arsip {
   id   String @id @default(uuid())
   namaBerkas String
   keterangan String
   tanggal DateTime
   url String
   url_id String
}

model JanjiTemu {
   id   String @id @default(uuid())
   idSiswa String
   idGuru String
   waktu DateTime
   status String
   deskripsi String
  Siswa Siswa   @relation(fields: [idSiswa], references: [id])
  Guru Guru   @relation(fields: [idGuru], references: [id])
}

model WeeklyActivity {
  id   String @id @default(uuid())
  idKelas String
  judul String?
  content String
  waktu DateTime
  Kelas Kelas   @relation(fields: [idKelas], references: [id])
  FotoWeeklyActivity FotoWeeklyActivity[]

}

model FotoWeeklyActivity {
  id   String @id @default(uuid())
  idWeeklyActivity String
  fotoUrl String
  fotoId String
  WeeklyAktivity WeeklyActivity   @relation(fields: [idWeeklyActivity], references: [id])

}